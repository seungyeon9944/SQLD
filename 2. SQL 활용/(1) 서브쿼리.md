### ⭐서브쿼리

메인 쿼리 안에 존재하는 또다른 쿼리

*✏️ **비연관 서브쿼리** : 메인쿼리의 컬럼이 포함되지않은 서브쿼리 도 존재*

*✏️ **NOT IN** 연산자는 **서브쿼리 값이 NULL**이면 전체 조건이 거짓이 됨 ! **출력 X 0건 !!!!***

*✏️ **NOT EXISTS** 연산자는 **같지만 않으면 거짓인거니까  NULL ≠ NULL이어서 세어줘야함***

```sql
SELECT COUNT(*) FROM TAB1
WHERE NOT EXISTS (SELECT 'X' FROM TAB2 WHERE TAB1.ID = TAB2.ID);
```

- **스칼라 서브쿼리** (Scalar Subquery) - **SELECT 절**
    
    *✏️ 스칼라 서브쿼리가 여러 행이면 출력불가*
    
    *✏️ 하나의 로우에 해당하는 서브쿼리 결과 건수는 1건 이하여야 (생략 불가!)*
    

```sql
SELECT M.PRODUCT_CODE,
       (SELECT S.PRODUCT_NAME # 테이블에 존재하지않는 PRODUCT_NAME 데이터 출력
          FROM PRODUCT S
          WHERE S.PRODUCT_CODE = M.PRODUCT_CODE) AS PRODUCT_NAME,
        M.MEMBER_ID,
        M.CONTENT
   FROM PRODUCT_REVIEW M;
```

- **인라인 뷰** (Inline View) - **FROM 절**

```sql
SELECT M.PRODUCT_CODE,
       S.PRODUCT_NAME,
       S.PRICE,
       M.MEMBER_ID,
       M.CONTENT
  FROM PRODUCT_REVIEW M,
      (SELECT PRODUCT_CODE,
              PRODUCT_NAME,
              PRICE
         FROM PRODUCT) S
 WHERE M.PRODUCT_CODE = S.PRODUCT_CODE;
```

- **중첩 서브쿼리** (Nested Subquery) - **WHERE 절, HAVING 절**

반환하는 데이터 형태에 따라 단일 행 서브쿼리, 다중 행 서브쿼리, 다중 컬럼 서브쿼리로 나눌 수 있음

✏️ *단일 행 서브쿼리 : ‘=’ 사용 / 다중 행 서브쿼리 : IN 절 사용 (오류 발생주의 !)*

```sql
SELECT EMPLOYEE_ID,
       NAME
  FROM EMPLOYEES
 WHERE DEPARTMENT_ID = (SELECT DEPARTMENT_ID
                           FROM EMPLOYEES
                          WHERE DEPARTMENT_ID LIKE '%5'); # 단일 행 서브쿼리
SELECT EMPLOYEE_ID,
       NAME
  FROM EMPLOYEES
 WHERE DEPARTMENT_ID IN (SELECT DEPARTMENT_ID
                           FROM EMPLOYEES
                          WHERE DEPARTMENT_ID LIKE '%3'); # 다중 행 서브쿼리   
```

- **비연관 서브쿼리** (Uncorrelated Subquery) : *✏️ 메인쿼리의 컬럼이 포함되지않은 (존재하지않는) 서브쿼리*

```sql
SELECT * FROM AGENCY;
SELECT * FROM ENTERTAINER;
SELECT NAME, JOB, BIRTHDAY, AGENCY_CODE
FROM ENTERTAINER
WHERE AGENCY_CODE = (SELECT AGENCY_CODE
                       FROM AGENCY
                      WHERE AGENCY_NAME = 'EDAM엔터테인먼트');
```

- **연관 서브쿼리** (Correlated Subquery) : 서브쿼리 내에 메인쿼리 O

```sql
SELECT * FROM CAFE_ORDER;
SELECT ORDER_NO,
       DRINK_CODE,
       ORDER_CNT
  FROM CAFE_ORDER A
 WHERE ORDER_CNT = (SELECT MAX(ORDER_CNT)
                      FROM CAFE_ORDER B
                     WHERE B.DRINK_CODE = A.DRINK_CODE);
```